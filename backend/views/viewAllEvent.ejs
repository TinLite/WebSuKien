<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>Dashboard</title>
  </head>

  <body>
    <div class="container-fluid">
      <div class="row flex-nowrap">
        <div class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-dark">
          <%- include('layout/sidebar'); %>
        </div>
        <div class="container mt-5 col-10">
          <h2 class="text-center">BẢNG SỰ KIỆN</h2>
          <div class="d-flex justify-content-between mb-3">
            <a href="/addevent" class="btn btn-primary">Thêm sự kiện</a>
            <form>
              <input type="text" name="find" />
              <button type="submit">Tìm</button>
            </form>
          </div>
          <table class="table table-bordered table-striped">
            <thead class="table-dark">
              <tr>
                <th scope="col">STT</th>
                <th scope="col">Người tạo sự kiện</th>
                <th scope="col">Tên sự kiện</th>
                <th scope="col">Ẩn</th>
                <th scope="col">Thời hạn đăng ký</th>
                <th scope="col">Thời gian tạo sự kiện</th>
                <th scope="col">Ngày diễn ra sự kiện</th>
                <th scope="col">Hành động</th>
              </tr>
            </thead>
            <tbody>
              <% data.listEvent.forEach(function(event, index) { %>
              <tr>
                <td><%= index+1 %></td>
                <td><%= event.username %></td>
                <td><%= event.name %></td>
                <td>
                  <input type="checkbox" <%= event.is_hidden ? 'checked' : ''
                  %>>
                </td>
                <td><%= event.reg_deadline.toLocaleDateString('vi-VN') %></td>
                <td><%= event.created_at.toLocaleDateString('vi-VN') %></td>
                <td><%= event.occasion_date.toLocaleDateString('vi-VN') %></td>
                <td>
                  <a class="btn btn-success" href="/detailevent/<%= event.ID %>">Xem</a>
                  <a class="btn btn-primary" href="/editevent/<%= event.ID %>"
                    >Sửa</a
                  >
                  <form
                    method="post"
                    action="/deleteevent"
                    class="d-inline-block"
                  >
                    <input
                      type="text"
                      value="<%= event.ID %>"
                      name="idevent"
                      hidden
                    />
                    <button class="btn btn-danger">Xóa</button>
                  </form>
                  <form method="post" action="/markAttendance" class="d-inline-block">
                    <input type="text" name="id_event" value="<%= event.ID %>" hidden />
                    <input type="text" name="id_user" value="<%= session.user.ID %>" hidden />
                    <% if (event.attendanceStatus === 1) { %>
                      <button class="btn btn-danger">Hủy điểm danh</button>
                    <% } else { %>
                      <button class="btn btn-warning">Điểm danh</button>
                    <% } %> 
                  </form>
                  <form method="post" action="/lockEvent" class="d-inline-block">
                    <input type="text" name="idevent" value="<%= event.ID %>" hidden />
                    <button class="btn btn-warning">Khóa đăng ký</button>
                  </form>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
